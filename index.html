<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mapa — Mini-juego Indiana Jones</title>
<style>
  :root{
    --paper:#f0e2c8;
    --burn:#cfa86b;
    --accent:#6b3f1f;
  }
  html,body{height:100%;margin:0;font-family: "Helvetica Neue", Arial, sans-serif;background:#6a583f;}
  .wrap{
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;
  }

  /* Map card */
  .map {
    width: 920px;
    max-width:96vw;
    aspect-ratio: 16/10;
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.04)), var(--paper);
    border-radius:14px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.5), inset 0 2px 0 rgba(255,255,255,0.3);
    position:relative;
    overflow:hidden;
    padding:22px;
  }

  /* subtle paper texture via repeating-radial-gradient */
  .map::before{
    content:"";
    position:absolute; inset:0;
    background-image:
      radial-gradient(circle at 10% 10%, rgba(0,0,0,0.03) 0 1px, transparent 2px),
      radial-gradient(circle at 90% 80%, rgba(0,0,0,0.02) 0 1px, transparent 2px),
      repeating-linear-gradient(90deg, rgba(0,0,0,0.01) 0 1px, transparent 1px 40px);
    mix-blend-mode:multiply;
    opacity:0.6;
    pointer-events:none;
  }

  /* Burnt edges */
  .map::after{
    content:"";
    position:absolute; inset:-10% -10% -10% -10%;
    background: radial-gradient(circle at 10% 5%, rgba(0,0,0,0.35), transparent 25%),
                radial-gradient(circle at 90% 95%, rgba(0,0,0,0.28), transparent 20%),
                linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.06));
    mix-blend-mode:multiply;
    pointer-events:none;
  }

  /* map content (island, paths, artifacts) */
  .map-inner{position:relative; width:100%; height:100%; border-radius:8px; overflow:hidden;}

  /* header / title */
  .title {
    position:absolute; left:24px; top:16px; font-weight:700; color:var(--accent); letter-spacing:0.06em;
    text-shadow: 0 1px 0 rgba(255,255,255,0.6);
  }

  /* the "map graphic" (SVG container) */
  .map-graphic{
    position:absolute; inset:0; padding:80px 40px 40px 40px; box-sizing:border-box;
  }

  /* hotspots style */
  .hotspot{
    position:absolute;
    width:44px; height:44px;
    transform:translate(-50%,-50%);
    border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer;
    transition:transform 200ms ease, opacity 200ms ease;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
  }
  .hotspot:active{transform:translate(-50%,-50%) scale(0.96);}
  .hotspot .xmark{
    width:34px; height:34px; display:block; font-weight:900; font-size:22px;
    color: rgba(107,63,31,0.95);
    filter: drop-shadow(0 2px 0 rgba(255,255,255,0.35));
  }
  .hotspot.hidden { opacity:0.48; }
  .hotspot.found { transform:translate(-50%,-50%) scale(1.35); opacity:1; }

  /* hint area */
  .hud{
    position:absolute; right:18px; top:18px; background:rgba(255,255,255,0.06);
    padding:10px 12px; border-radius:8px; color:#2b1608; font-weight:600; font-size:14px;
    text-align:right; backdrop-filter: blur(3px);
  }

  /* footer parchment text */
  .footer{
    position:absolute; left:20px; bottom:14px; right:20px; color:#603813; font-size:14px;
    display:flex; justify-content:space-between; align-items:center;
  }
  .clue{font-style:italic; opacity:0.9;}

  /* Modal for invitation */
  .modal {
    position: absolute; inset:0; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.45));
    backdrop-filter: blur(3px);
    opacity:0; pointer-events:none; transition:opacity 280ms ease;
  }
  .modal.show { opacity:1; pointer-events:auto; }

  .card {
    width:min(700px,94%);
    border-radius:12px; padding:20px; background:linear-gradient(180deg,#fffef6,#f7edd6);
    box-shadow:0 20px 40px rgba(0,0,0,0.45);
    text-align:center; color:#35200f;
  }
  .card h1{margin:6px 0 4px;font-size:26px;letter-spacing:0.03em;}
  .card p{margin:8px 0 14px;font-size:18px;}
  .movie {font-weight:800;color:#612e0d;margin-top:6px;}
  .cta-row{display:flex; gap:10px; justify-content:center; flex-wrap:wrap;}
  .btn{
    padding:10px 16px;border-radius:10px;border:0;font-weight:700;cursor:pointer;
    background:var(--accent); color:#fff; min-width:160px;
    box-shadow: 0 6px 18px rgba(107,63,31,0.28);
  }
  .btn.ghost{background:transparent;color:var(--accent);border:2px solid rgba(107,63,31,0.12)}
  .small{font-size:13px;padding:8px 12px;min-width:120px}

  /* small screen tweaks */
  @media (max-width:520px){
    .map{padding:12px;}
    .map-graphic{padding:60px 18px 18px 18px;}
    .hotspot{width:44px;height:44px;}
    .card h1{font-size:20px;}
    .card p{font-size:16px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="map" role="application" aria-label="Mapa del tesoro">
      <div class="map-inner">
        <div class="title">Mapa del tesoro</div>
        <div class="map-graphic" id="mapGraphic">
          <!-- Simple vector "island" map using SVG for visuals -->
          <svg viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet" style="width:100%;height:100%;border-radius:8px">
            <!-- parchment stains -->
            <defs>
              <filter id="grain">
                <feTurbulence baseFrequency="0.9" numOctaves="2" stitchTiles="stitch" />
                <feColorMatrix type="saturate" values="0.1" />
                <feBlend mode="multiply"/>
              </filter>
              <linearGradient id="sea" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0" stop-color="#f8f0dc"/>
                <stop offset="1" stop-color="#f0e2c8"/>
              </linearGradient>
            </defs>

            <!-- big parchment background -->
            <rect x="30" y="20" rx="12" ry="12" width="940" height="560" fill="url(#sea)" stroke="rgba(0,0,0,0.06)"/>

            <!-- a few decorative elements: path, mountains, temple -->
            <g stroke="#8b5a2b" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.9">
              <path d="M160,420 C220,320 340,340 420,300 C520,250 620,310 730,290" stroke-dasharray="6 8"/>
            </g>

            <!-- mountains -->
            <g fill="#b98b5a" opacity="0.9">
              <polygon points="220,360 260,280 300,360" />
              <polygon points="300,360 340,290 380,360" />
            </g>

            <!-- temple icon -->
            <g transform="translate(660,200)" opacity="0.95">
              <rect x="-16" y="10" width="80" height="42" fill="#7a4d2a" rx="6" />
              <rect x="0" y="-28" width="48" height="34" fill="#a46b3b" rx="4" />
              <text x="24" y="40" font-size="28" text-anchor="middle" fill="#fff" font-weight="700">⚱</text>
            </g>

            <!-- hand-drawn X marks faint (decoy) -->
            <g opacity="0.25" fill="none" stroke="#8b3f1f" stroke-width="6" stroke-linecap="round">
              <path d="M160 120 l20 20 M180 120 l-20 20" />
              <path d="M560 320 l24 24 M584 320 l-24 24" />
            </g>

            <!-- decorative compass -->
            <g transform="translate(860,440)" opacity="0.9">
              <circle cx="0" cy="0" r="36" fill="#fff7e9" stroke="#8a5530" stroke-width="3"/>
              <polygon points="-4,-28 8,0 -4,28 14,0" fill="#8a5530" transform="rotate(10)"/>
            </g>

          </svg>

          <!-- hotspots: position with percentages to make them responsive -->
          <!-- Hotspot 1 -->
          <div class="hotspot hidden" id="hot1" style="left:22%; top:62%;" title="Toca para buscar">
            <div class="xmark">X</div>
          </div>
          <!-- Hotspot 2 -->
          <div class="hotspot hidden" id="hot2" style="left:43%; top:44%;" title="Toca para buscar">
            <div class="xmark">X</div>
          </div>
          <!-- Hotspot 3 -->
          <div class="hotspot hidden" id="hot3" style="left:72%; top:31%;" title="Toca para buscar">
            <div class="xmark">X</div>
          </div>

        </div>

        <div class="hud" id="hud">Encontrados: <span id="count">0</span>/3</div>

        <div class="footer">
          <div class="clue">Pista: Sigue los ríos y las montañas.</div>
          <div style="font-weight:700; color:#6b3f1f">— Aventura</div>
        </div>

        <!-- modal invitation -->
        <div class="modal" id="modal">
          <div class="card" role="dialog" aria-modal="true" aria-labelledby="inviteTitle">
            <h1 id="inviteTitle">¡¡Vla, pasaste!!</h1>
            <p>¿Quieres ir al cine?</p>
            <div class="movie">Indiana Jones: Raiders of the Lost Ark</div>
            <p style="margin-top:10px;color:#5c3b28;font-size:14px">Puedes editar el mensaje antes de enviarlo.</p>

            <div style="margin-top:14px" class="cta-row">
              <button class="btn" id="whatsappBtn">Abrir en WhatsApp</button>
              <button class="btn ghost small" id="copyBtn">Copiar mensaje</button>
              <button class="btn ghost small" id="closeBtn">Cerrar</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
  // Game logic
  (function(){
    const hotspots = Array.from(document.querySelectorAll('.hotspot'));
    const countNode = document.getElementById('count');
    const modal = document.getElementById('modal');
    const whatsappBtn = document.getElementById('whatsappBtn');
    const copyBtn = document.getElementById('copyBtn');
    const closeBtn = document.getElementById('closeBtn');

    let found = 0;
    const total = hotspots.length;

    // Pre-defined message for WhatsApp (encoded later)
    const rawMessage = "¡¡Vla, pasaste!! ¿Quieres ir al cine? Indiana Jones: Raiders of the Lost Ark";

    function updateHUD(){
      countNode.textContent = found + "/" + total;
    }

    function revealIfComplete(){
      if(found >= total){
        // show modal invitation
        setTimeout(()=> {
          modal.classList.add('show');
        }, 260);
      }
    }

    function markFound(el){
      if(el.classList.contains('found')) return;
      el.classList.add('found');
      el.classList.remove('hidden');
      found++;
      updateHUD();
      // small pop sound (web audio)
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.value = 580 + Math.random()*80;
        g.gain.value = 0.01;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        setTimeout(()=>{ o.stop(); ctx.close(); }, 140);
      } catch(e){ /* audio blocked on some devices */ }
      revealIfComplete();
    }

    // Add listeners to hotspots
    hotspots.forEach(h => {
      // small random jitter initial position for feel (but maintain same percentage)
      h.addEventListener('click', (ev) => {
        ev.stopPropagation();
        markFound(h);
      });

      // support touch (touchend)
      h.addEventListener('touchend', (ev) => {
        ev.preventDefault();
        markFound(h);
      });
    });

    // clicking outside provides a hint animation
    document.getElementById('mapGraphic').addEventListener('click', (e)=>{
      // gentle shake of the nearest hidden hotspot to the click location
      const rect = e.currentTarget.getBoundingClientRect();
      const x = (e.clientX - rect.left)/rect.width;
      const y = (e.clientY - rect.top)/rect.height;
      // find nearest not found hotspot
      let nearest = null;
      let best = Infinity;
      hotspots.forEach(h => {
        if(h.classList.contains('found')) return;
        const cx = parseFloat(h.style.left)/100;
        const cy = parseFloat(h.style.top)/100;
        const d = Math.hypot(cx-x, cy-y);
        if(d < best){ best = d; nearest = h; }
      });
      if(nearest && best < 0.5){
        nearest.animate([
          { transform: 'translate(-50%,-50%) scale(1)' },
          { transform: 'translate(-50%,-50%) scale(1.08)' },
          { transform: 'translate(-50%,-50%) scale(1)' }
        ], { duration: 420, easing: 'ease-out' });
      }
    });

    // Buttons in modal
    whatsappBtn.addEventListener('click', ()=>{
      const encoded = encodeURIComponent(rawMessage);
      // opens the default WhatsApp via wa.me (works on mobile)
      const waUrl = `https://wa.me/?text=${encoded}`;
      window.open(waUrl, '_blank');
    });

    copyBtn.addEventListener('click', async ()=>{
      try {
        await navigator.clipboard.writeText(rawMessage);
        copyBtn.textContent = "Copiado ✅";
        setTimeout(()=> copyBtn.textContent = "Copiar mensaje", 1800);
      } catch(e){
        copyBtn.textContent = "No se pudo copiar";
      }
    });

    closeBtn.addEventListener('click', ()=>{
      modal.classList.remove('show');
    });

    // Init: small fade-in of hotspots (to feel hidden)
    setTimeout(()=> {
      hotspots.forEach(h => {
        h.classList.remove('hidden');
        h.style.opacity = 0.88;
      });
    }, 360);

    updateHUD();
  })();
</script>
</body>
</html>
